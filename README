
Purpose
-------

This is just a toy repo of some experiments. I wanted to see if it was worth
using a general mechanism for the pattern where you have a container of type T
and want to sort it using a member of that type, rather than the type itself.

Consider the contrived example:

--------------8<--------------
struct PhoneBookEntry {
    string name;
    int area_code;
    int number;
};

vector<PhoneBookEntry> phone_book;

bool sort_by_name(PhoneBookEntry const& e1, PhoneBookEntry const& e2) {
    return e1.name < e2.name;
}

bool sort_by_area_code(PhoneBookEntry const& e1, PhoneBookEntry const& e2) {
    return e1.area_code < e2.area_code;
}

bool sort_by_number(PhoneBookEntry const& e1, PhoneBookEntry const& e2) {
    return e1.number < e2.number;
}

sort( phone_book.begin(), phone_book.end(), &sort_by_name );
sort( phone_book.begin(), phone_book.end(), &sort_by_area_code );
sort( phone_book.begin(), phone_book.end(), &sort_by_number );
-------------->8--------------

Now consider having to sort in reverse order. It's not difficult, it's just a
lot of boiler-plate to write, test and maintain. It's also less obvious to
reason about because the function passed to sort is declared elsewhere so what
it does relies on good (possibly very verbose) naming.

An alternative syntax I've implemented here allows you to do this instead:

--------------8<--------------
struct PhoneBookEntry {
    string name;
    int area_code;
    int number;
};

vector<PhoneBookEntry> phone_book;

sort( phone_book.begin(), phone_book.end(), less_than(&PhoneBookEntry::name) );
sort( phone_book.begin(), phone_book.end(), less_than(&PhoneBookEntry::area_code) );
sort( phone_book.begin(), phone_book.end(), less_than(&PhoneBookEntry::number) );
// And in reverse:
sort( phone_book.begin(), phone_book.end(), greater_than(&PhoneBookEntry::name) );
sort( phone_book.begin(), phone_book.end(), greater_than(&PhoneBookEntry::area_code) );
sort( phone_book.begin(), phone_book.end(), greater_than(&PhoneBookEntry::number) );
-------------->8--------------

My benchmarks show that it's possible to implement this generically almost as
efficiently as hard-coded functions. Code bloat isn't particularly significant
either.

If you have any improvements or alternatives, share 'em!

Requires
--------

Boost 1.52+
cmake

Compililation
-------------

./build.sh

Run tests
---------

The point of this all is to see the effect on compiled size and runtime from
different ways of implementing a lazy function / function object.

To see compiled size:

./get-sizes.sh

To see running times:

./run-tests.sh

Example
-------

Here's what I get on my machine:

$ uname -a
Linux localhost.localdomain 3.8.3-203.fc18.i686.PAE #1 SMP Mon Mar 18 13:11:17 UTC 2013 i686 i686 i386 GNU/Linux

$ gcc --version
gcc (GCC) 4.7.2 20121109 (Red Hat 4.7.2-8)

$ clang --version
clang version 3.3 (trunk 177624)
Target: i386-pc-linux-gnu
Thread model: posix


Sizes
-----

clang	less_than	30216	hard_coded_function_objects
clang	less_than	30216	hard_coded_functions
clang	less_than	30216	hard_coded_functions_inline
clang	less_than	30216	operator_wrapper_with_operator_passed_to_it
clang	less_than	30216	operator_wrapper_with_operator_selected_using_enum1
clang	less_than	30216	operator_wrapper_with_operator_selected_using_enum2
clang	less_than	30216	operator_wrapper_with_operator_selected_using_enum3
clang	less_than	30216	operator_wrapper_with_operator_templated_on_op_type_enable_if
clang	less_than	30216	operator_wrapper_with_operator_templated_on_op_type_full_specialization
clang	less_than	30216	templated_function_objects_with_hard_coded_member_name
clang	less_than	34312	bind_expressions_inline
clang	less_than	54832	bind_expressions_returned_as_boost_functions
clang	less_than	54832	bind_expressions_returned_as_boost_functions_from_hard_coded_functions
clang	greater_than	30216	hard_coded_function_objects
clang	greater_than	30216	hard_coded_functions
clang	greater_than	30216	hard_coded_functions_inline
clang	greater_than	30216	operator_wrapper_with_operator_passed_to_it
clang	greater_than	30216	operator_wrapper_with_operator_selected_using_enum1
clang	greater_than	30216	operator_wrapper_with_operator_selected_using_enum2
clang	greater_than	30216	operator_wrapper_with_operator_selected_using_enum3
clang	greater_than	30216	operator_wrapper_with_operator_templated_on_op_type_enable_if
clang	greater_than	30216	operator_wrapper_with_operator_templated_on_op_type_full_specialization
clang	greater_than	30216	templated_function_objects_with_hard_coded_member_name
clang	greater_than	34312	bind_expressions_inline
clang	greater_than	54832	bind_expressions_returned_as_boost_functions
clang	greater_than	54832	bind_expressions_returned_as_boost_functions_from_hard_coded_functions
clang	equal_to	30216	hard_coded_function_objects
clang	equal_to	30216	hard_coded_functions
clang	equal_to	30216	hard_coded_functions_inline
clang	equal_to	30216	operator_wrapper_with_operator_passed_to_it
clang	equal_to	30216	operator_wrapper_with_operator_selected_using_enum1
clang	equal_to	30216	operator_wrapper_with_operator_selected_using_enum2
clang	equal_to	30216	operator_wrapper_with_operator_selected_using_enum3
clang	equal_to	30216	operator_wrapper_with_operator_templated_on_op_type_enable_if
clang	equal_to	30216	operator_wrapper_with_operator_templated_on_op_type_full_specialization
clang	equal_to	30216	templated_function_objects_with_hard_coded_member_name
clang	equal_to	34312	bind_expressions_inline
clang	equal_to	54832	bind_expressions_returned_as_boost_functions
clang	equal_to	54832	bind_expressions_returned_as_boost_functions_from_hard_coded_functions
clang	multi_sort	30216	hard_coded_functions
clang	multi_sort	30216	hard_coded_functions_inline
clang	multi_sort	30216	operator_wrapper_with_operator_passed_to_it
clang	multi_sort	30216	operator_wrapper_with_operator_selected_using_enum1
clang	multi_sort	30216	operator_wrapper_with_operator_selected_using_enum2
clang	multi_sort	30216	operator_wrapper_with_operator_selected_using_enum3
clang	multi_sort	42504	hard_coded_function_objects
clang	multi_sort	42504	operator_wrapper_with_operator_templated_on_op_type_enable_if
clang	multi_sort	42504	templated_function_objects_with_hard_coded_member_name
clang	multi_sort	46600	bind_expressions_inline
clang	multi_sort	46600	operator_wrapper_with_operator_templated_on_op_type_full_specialization
clang	multi_sort	54832	bind_expressions_returned_as_boost_functions
clang	multi_sort	54832	bind_expressions_returned_as_boost_functions_from_hard_coded_functions
default	less_than	26184	bind_expressions_inline
default	less_than	26184	operator_wrapper_with_operator_passed_to_it
default	less_than	30280	hard_coded_function_objects
default	less_than	30280	hard_coded_functions
default	less_than	30280	hard_coded_functions_inline
default	less_than	30280	operator_wrapper_with_operator_selected_using_enum1
default	less_than	30280	operator_wrapper_with_operator_selected_using_enum2
default	less_than	30280	operator_wrapper_with_operator_selected_using_enum3
default	less_than	30280	operator_wrapper_with_operator_templated_on_op_type_enable_if
default	less_than	30280	operator_wrapper_with_operator_templated_on_op_type_full_specialization
default	less_than	30280	templated_function_objects_with_hard_coded_member_name
default	less_than	46696	bind_expressions_returned_as_boost_functions
default	less_than	46696	bind_expressions_returned_as_boost_functions_from_hard_coded_functions
default	greater_than	26184	operator_wrapper_with_operator_passed_to_it
default	greater_than	30280	bind_expressions_inline
default	greater_than	30280	hard_coded_function_objects
default	greater_than	30280	hard_coded_functions
default	greater_than	30280	hard_coded_functions_inline
default	greater_than	30280	operator_wrapper_with_operator_selected_using_enum1
default	greater_than	30280	operator_wrapper_with_operator_selected_using_enum2
default	greater_than	30280	operator_wrapper_with_operator_selected_using_enum3
default	greater_than	30280	operator_wrapper_with_operator_templated_on_op_type_enable_if
default	greater_than	30280	operator_wrapper_with_operator_templated_on_op_type_full_specialization
default	greater_than	30280	templated_function_objects_with_hard_coded_member_name
default	greater_than	46696	bind_expressions_returned_as_boost_functions
default	greater_than	46696	bind_expressions_returned_as_boost_functions_from_hard_coded_functions
default	equal_to	26184	operator_wrapper_with_operator_passed_to_it
default	equal_to	26184	operator_wrapper_with_operator_templated_on_op_type_enable_if
default	equal_to	30280	bind_expressions_inline
default	equal_to	30280	hard_coded_function_objects
default	equal_to	30280	hard_coded_functions
default	equal_to	30280	hard_coded_functions_inline
default	equal_to	30280	operator_wrapper_with_operator_selected_using_enum1
default	equal_to	30280	operator_wrapper_with_operator_selected_using_enum2
default	equal_to	30280	operator_wrapper_with_operator_selected_using_enum3
default	equal_to	30280	operator_wrapper_with_operator_templated_on_op_type_full_specialization
default	equal_to	30280	templated_function_objects_with_hard_coded_member_name
default	equal_to	46696	bind_expressions_returned_as_boost_functions
default	equal_to	46696	bind_expressions_returned_as_boost_functions_from_hard_coded_functions
default	multi_sort	30280	operator_wrapper_with_operator_passed_to_it
default	multi_sort	30280	operator_wrapper_with_operator_selected_using_enum1
default	multi_sort	30280	operator_wrapper_with_operator_selected_using_enum2
default	multi_sort	30280	operator_wrapper_with_operator_selected_using_enum3
default	multi_sort	34376	hard_coded_functions
default	multi_sort	34376	hard_coded_functions_inline
default	multi_sort	46664	bind_expressions_inline
default	multi_sort	46664	hard_coded_function_objects
default	multi_sort	46664	operator_wrapper_with_operator_templated_on_op_type_enable_if
default	multi_sort	46664	operator_wrapper_with_operator_templated_on_op_type_full_specialization
default	multi_sort	46664	templated_function_objects_with_hard_coded_member_name
default	multi_sort	46696	bind_expressions_returned_as_boost_functions
default	multi_sort	46696	bind_expressions_returned_as_boost_functions_from_hard_coded_functions


Running times
-------------

clang	less_than	6.643812	6.630000	0.000000	6.630000	templated_function_objects_with_hard_coded_member_name
clang	less_than	6.669624	6.620000	0.010000	6.630000	hard_coded_function_objects
clang	less_than	6.772601	6.760000	0.000000	6.760000	operator_wrapper_with_operator_templated_on_op_type_full_specialization
clang	less_than	6.837770	6.810000	0.010000	6.820000	operator_wrapper_with_operator_templated_on_op_type_enable_if
clang	less_than	6.874389	6.840000	0.010000	6.850000	bind_expressions_inline
clang	less_than	7.263405	7.240000	0.000000	7.240000	hard_coded_functions
clang	less_than	7.391998	7.340000	0.020000	7.360000	hard_coded_functions_inline
clang	less_than	7.656084	7.640000	0.000000	7.640000	operator_wrapper_with_operator_passed_to_it
clang	less_than	8.013294	7.970000	0.010000	7.980000	operator_wrapper_with_operator_selected_using_enum2
clang	less_than	8.014912	7.980000	0.010000	7.990000	operator_wrapper_with_operator_selected_using_enum1
clang	less_than	8.283738	8.250000	0.010000	8.260000	operator_wrapper_with_operator_selected_using_enum3
clang	less_than	13.497236	13.390000	0.040000	13.430000	bind_expressions_returned_as_boost_functions
clang	less_than	13.597525	13.570000	0.000000	13.570000	bind_expressions_returned_as_boost_functions_from_hard_coded_functions
clang	greater_than	6.705802	6.690000	0.000000	6.690000	templated_function_objects_with_hard_coded_member_name
clang	greater_than	6.883416	6.870000	0.000000	6.870000	hard_coded_function_objects
clang	greater_than	6.893872	6.870000	0.000000	6.870000	operator_wrapper_with_operator_templated_on_op_type_full_specialization
clang	greater_than	6.938829	6.930000	0.000000	6.930000	operator_wrapper_with_operator_templated_on_op_type_enable_if
clang	greater_than	7.034627	7.020000	0.000000	7.020000	bind_expressions_inline
clang	greater_than	7.513592	7.490000	0.000000	7.490000	hard_coded_functions
clang	greater_than	7.524725	7.510000	0.000000	7.510000	hard_coded_functions_inline
clang	greater_than	7.750329	7.730000	0.000000	7.730000	operator_wrapper_with_operator_passed_to_it
clang	greater_than	8.114693	8.090000	0.000000	8.090000	operator_wrapper_with_operator_selected_using_enum1
clang	greater_than	8.157091	8.130000	0.000000	8.130000	operator_wrapper_with_operator_selected_using_enum3
clang	greater_than	8.261668	8.240000	0.000000	8.240000	operator_wrapper_with_operator_selected_using_enum2
clang	greater_than	13.728119	13.660000	0.020000	13.680000	bind_expressions_returned_as_boost_functions
clang	greater_than	13.779973	13.750000	0.000000	13.750000	bind_expressions_returned_as_boost_functions_from_hard_coded_functions
clang	equal_to	5.736871	5.720000	0.000000	5.720000	templated_function_objects_with_hard_coded_member_name
clang	equal_to	5.826819	5.810000	0.000000	5.810000	hard_coded_function_objects
clang	equal_to	5.931051	5.910000	0.000000	5.910000	operator_wrapper_with_operator_templated_on_op_type_full_specialization
clang	equal_to	6.006950	5.990000	0.000000	5.990000	bind_expressions_inline
clang	equal_to	6.026870	6.020000	0.000000	6.020000	operator_wrapper_with_operator_templated_on_op_type_enable_if
clang	equal_to	6.215186	6.200000	0.000000	6.200000	hard_coded_functions
clang	equal_to	6.355879	6.340000	0.000000	6.340000	hard_coded_functions_inline
clang	equal_to	6.811786	6.790000	0.000000	6.790000	operator_wrapper_with_operator_selected_using_enum1
clang	equal_to	6.824930	6.800000	0.000000	6.800000	operator_wrapper_with_operator_passed_to_it
clang	equal_to	6.856772	6.840000	0.000000	6.840000	operator_wrapper_with_operator_selected_using_enum2
clang	equal_to	6.886199	6.870000	0.000000	6.870000	operator_wrapper_with_operator_selected_using_enum3
clang	equal_to	12.960240	12.940000	0.000000	12.940000	bind_expressions_returned_as_boost_functions_from_hard_coded_functions
clang	equal_to	13.057745	13.020000	0.000000	13.020000	bind_expressions_returned_as_boost_functions
clang	multi_sort	25.873495	25.820000	0.000000	25.820000	templated_function_objects_with_hard_coded_member_name
clang	multi_sort	25.911232	25.810000	0.030000	25.840000	hard_coded_function_objects
clang	multi_sort	26.364433	26.270000	0.020000	26.290000	operator_wrapper_with_operator_templated_on_op_type_full_specialization
clang	multi_sort	26.359774	26.310000	0.000000	26.310000	operator_wrapper_with_operator_templated_on_op_type_enable_if
clang	multi_sort	26.945551	26.860000	0.010000	26.870000	bind_expressions_inline
clang	multi_sort	29.144692	29.020000	0.040000	29.060000	hard_coded_functions_inline
clang	multi_sort	29.646418	29.490000	0.050000	29.540000	hard_coded_functions
clang	multi_sort	31.077164	31.020000	0.000000	31.020000	operator_wrapper_with_operator_passed_to_it
clang	multi_sort	31.208571	31.080000	0.040000	31.120000	operator_wrapper_with_operator_selected_using_enum3
clang	multi_sort	31.414710	31.330000	0.010000	31.340000	operator_wrapper_with_operator_selected_using_enum2
clang	multi_sort	31.947455	31.820000	0.040000	31.860000	operator_wrapper_with_operator_selected_using_enum1
clang	multi_sort	55.244860	55.130000	0.000000	55.130000	bind_expressions_returned_as_boost_functions_from_hard_coded_functions
clang	multi_sort	56.206246	56.000000	0.060000	56.060000	bind_expressions_returned_as_boost_functions
default	less_than	6.480373	6.460000	0.000000	6.460000	hard_coded_functions_inline
default	less_than	6.537940	6.520000	0.000000	6.520000	hard_coded_functions
default	less_than	6.624554	6.610000	0.000000	6.610000	hard_coded_function_objects
default	less_than	6.652164	6.630000	0.000000	6.630000	operator_wrapper_with_operator_templated_on_op_type_full_specialization
default	less_than	6.659462	6.630000	0.010000	6.640000	templated_function_objects_with_hard_coded_member_name
default	less_than	6.695800	6.670000	0.000000	6.670000	operator_wrapper_with_operator_templated_on_op_type_enable_if
default	less_than	6.831371	6.810000	0.000000	6.810000	operator_wrapper_with_operator_selected_using_enum1
default	less_than	6.873041	6.830000	0.010000	6.840000	bind_expressions_inline
default	less_than	6.929085	6.900000	0.000000	6.900000	operator_wrapper_with_operator_selected_using_enum2
default	less_than	7.072885	7.060000	0.000000	7.060000	operator_wrapper_with_operator_selected_using_enum3
default	less_than	7.349167	7.330000	0.000000	7.330000	operator_wrapper_with_operator_passed_to_it
default	less_than	13.920593	13.890000	0.000000	13.890000	bind_expressions_returned_as_boost_functions_from_hard_coded_functions
default	less_than	13.959860	13.930000	0.000000	13.930000	bind_expressions_returned_as_boost_functions
default	greater_than	6.570318	6.550000	0.000000	6.550000	hard_coded_functions
default	greater_than	6.646945	6.620000	0.000000	6.620000	hard_coded_functions_inline
default	greater_than	6.748142	6.700000	0.020000	6.720000	templated_function_objects_with_hard_coded_member_name
default	greater_than	6.748547	6.730000	0.000000	6.730000	hard_coded_function_objects
default	greater_than	6.749942	6.730000	0.000000	6.730000	operator_wrapper_with_operator_templated_on_op_type_enable_if
default	greater_than	6.785957	6.760000	0.010000	6.770000	operator_wrapper_with_operator_templated_on_op_type_full_specialization
default	greater_than	6.956469	6.940000	0.000000	6.940000	bind_expressions_inline
default	greater_than	6.982225	6.950000	0.010000	6.960000	operator_wrapper_with_operator_selected_using_enum3
default	greater_than	7.072803	7.060000	0.000000	7.060000	operator_wrapper_with_operator_selected_using_enum2
default	greater_than	7.156888	7.140000	0.000000	7.140000	operator_wrapper_with_operator_selected_using_enum1
default	greater_than	7.499888	7.450000	0.010000	7.460000	operator_wrapper_with_operator_passed_to_it
default	greater_than	13.947459	13.880000	0.020000	13.900000	bind_expressions_returned_as_boost_functions
default	greater_than	14.396003	14.320000	0.020000	14.340000	bind_expressions_returned_as_boost_functions_from_hard_coded_functions
default	equal_to	5.262350	5.220000	0.010000	5.230000	hard_coded_functions
default	equal_to	5.292315	5.270000	0.000000	5.270000	hard_coded_functions_inline
default	equal_to	5.432879	5.420000	0.000000	5.420000	templated_function_objects_with_hard_coded_member_name
default	equal_to	5.488002	5.440000	0.020000	5.460000	operator_wrapper_with_operator_templated_on_op_type_enable_if
default	equal_to	5.552415	5.510000	0.010000	5.520000	hard_coded_function_objects
default	equal_to	5.668842	5.640000	0.010000	5.650000	bind_expressions_inline
default	equal_to	5.777189	5.760000	0.000000	5.760000	operator_wrapper_with_operator_selected_using_enum1
default	equal_to	5.850633	5.820000	0.000000	5.820000	operator_wrapper_with_operator_selected_using_enum3
default	equal_to	5.906320	5.860000	0.020000	5.880000	operator_wrapper_with_operator_templated_on_op_type_full_specialization
default	equal_to	5.925382	5.900000	0.000000	5.900000	operator_wrapper_with_operator_selected_using_enum2
default	equal_to	6.127660	6.110000	0.000000	6.110000	operator_wrapper_with_operator_passed_to_it
default	equal_to	12.983822	12.880000	0.030000	12.910000	bind_expressions_returned_as_boost_functions
default	equal_to	12.981428	12.930000	0.000000	12.930000	bind_expressions_returned_as_boost_functions_from_hard_coded_functions
default	multi_sort	25.074759	25.020000	0.000000	25.020000	hard_coded_functions
default	multi_sort	25.294035	25.140000	0.050000	25.190000	hard_coded_functions_inline
default	multi_sort	25.362576	25.310000	0.000000	25.310000	hard_coded_function_objects
default	multi_sort	25.569958	25.510000	0.000000	25.510000	operator_wrapper_with_operator_templated_on_op_type_full_specialization
default	multi_sort	25.591148	25.550000	0.000000	25.550000	operator_wrapper_with_operator_templated_on_op_type_enable_if
default	multi_sort	25.603878	25.560000	0.000000	25.560000	templated_function_objects_with_hard_coded_member_name
default	multi_sort	26.437004	26.370000	0.010000	26.380000	operator_wrapper_with_operator_selected_using_enum1
default	multi_sort	26.853503	26.800000	0.000000	26.800000	operator_wrapper_with_operator_selected_using_enum2
default	multi_sort	27.194668	27.130000	0.000000	27.130000	bind_expressions_inline
default	multi_sort	27.763148	27.670000	0.020000	27.690000	operator_wrapper_with_operator_selected_using_enum3
default	multi_sort	29.317685	29.260000	0.000000	29.260000	operator_wrapper_with_operator_passed_to_it
default	multi_sort	53.938234	53.830000	0.000000	53.830000	bind_expressions_returned_as_boost_functions
default	multi_sort	54.027130	53.910000	0.000000	53.910000	bind_expressions_returned_as_boost_functions_from_hard_coded_functions

